name: Nightwatch Tests
on:
  workflow_call:
    inputs:
      config-path:
        required: true
        type: string
    secrets:
      SNOW_USERNAME:
        required: true
      SNOW_PASS:
        required: true

  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build:
    defaults:
      run:
        working-directory: /home/runner/work/PIE_tools/PIE_tools/nightwatch
     
      
  
    runs-on: ubuntu-latest

    strategy:
      matrix:
        node-version: [18.x]

    steps:
    - uses: actions/checkout@v3
    - name: Use Node.js ${{ matrix.node-version }}
      uses: actions/setup-node@v3
      with:
        node-version: ${{ matrix.node-version }}
        cache: 'npm'
        cache-dependency-path: '**/package.json'


    - uses: oNaiPs/secrets-to-env-action@v1
      with:
        secrets: ${{ toJSON(secrets) }}

    - uses: browser-actions/setup-chrome@v1
      with:
        chrome-version: 'latest'
      id: setup-chrome
     
    - uses: nanasess/setup-chromedriver@v2

    - name: Tell me a secret!
      env:
        SNOW_USERNAME: ${{ secrets.SNOW_USERNAME }}
        SNOW_PASS: ${{ secrets.SNOW_PASS }}
      run: |
        echo "My existing secret is ${{ toJSON(secrets) }}"
        echo "My secret is $SNOW_USERNAME"


            

    # - run: |
    #     echo "Value of SNOW_USERNAME: $SNOW_USERNAME"
    #     echo "Value of secrets SNOW_USERNAME: ${{ toJSON(secrets) }}"
    #     echo Installed chromium version: ${{ steps.setup-chrome.outputs.chrome-version }}
    #     ${{ steps.setup-chrome.outputs.chrome-path }} --version
    #     export DISPLAY=:99
    #     sudo Xvfb -ac :99 -screen 0 1280x1024x24 > /dev/null 2>&1 & # optional
    #     mkdir -p /home/runner/work/PIE_tools/PIE_tools/nightwatch/custom-assertions 
    #     mkdir -p /home/runner/work/PIE_tools/PIE_tools/nightwatch/custom-commands
    #     mkdir -p /home/runner/work/PIE_tools/PIE_tools/nightwatch/page-objects 
    #     mkdir -p /home/runner/work/PIE_tools/PIE_tools/nightwatch/examples
    #     npm install
    #     /usr/local/bin/chromedriver --version
    #     /opt/google/chrome/chrome --version
    #     npx nightwatch --config nightwatch.conf.js tests/snow_run_command.js

